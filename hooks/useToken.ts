import { useEffect, useState } from "react";

export const useToken = () => {
  const [token, setToken] = useState<string | null>(null);

  const generateToken = () => {
    if (crypto.randomUUID) {
      return crypto.randomUUID(); // Ğ¡Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¾ÑĞ¾Ğ±
    }
  
    // Ğ—Ğ°Ğ¿Ğ°ÑĞ½Ğ¾Ğ¹ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ Ğ½Ğ° ÑĞ»ÑƒÑ‡Ğ°Ğ¹ ÑÑ‚Ğ°Ñ€Ğ¾Ğ³Ğ¾ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ°
    const array = new Uint32Array(4);
    crypto.getRandomValues(array);
    return Array.from(array, dec => dec.toString(16)).join("-");
  };

  useEffect(() => {
    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ğ° Ğ² localStorage
    let savedToken = localStorage.getItem("token");

    if (!savedToken) {
      // Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ñ‚Ğ¾ĞºĞµĞ½Ğ° (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ·Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ½Ğ° uuid)
      savedToken = generateToken();
      localStorage.setItem("token", savedToken);
      console.log("âœ… ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ‚Ğ¾ĞºĞµĞ½ ÑĞ¾Ğ·Ğ´Ğ°Ğ½:", savedToken);
    } else {
      console.log("ğŸ” Ğ¢Ğ¾ĞºĞµĞ½ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½:", savedToken);
    }

    setToken(savedToken);
  }, []);

  // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ° (ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ğ°)
  const logout = () => {
    localStorage.removeItem("token");
    setToken(null);
    console.log("ğŸšª Ğ’Ñ‹ÑˆĞ»Ğ¸ Ğ¸Ğ· ÑĞµÑÑĞ¸Ğ¸");
  };

  return { token };
};
